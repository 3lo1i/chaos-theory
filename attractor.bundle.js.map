{"version":3,"sources":["webpack:///./src/modules/attractor/attractor.js","webpack:///./src/modules/attractor/attractor.pug","webpack:///./src/utils/save-utils.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACqB;;AAErB;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B,+BAA+B;AAC/B,+BAA+B;AAC/B,+BAA+B;AAC/B,+BAA+B;AAC/B,+BAA+B;AAC/B;AACA;;;AAGA,uCAAuC,wBAAwB;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC,oCAAoC;AACpC,oCAAoC;AACpC,kCAAkC;AAClC;AACA;AACA;;;AAGA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA,sDAAsD,IAAI;AAC1D;AACA;AACA;AACA,kCAAkC,IAAI;AACtC,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,gEAAgB;;;;;;;;;;;;AC9GhB;;AAEA,2BAA2B,kCAAkC;;;;;;;;;;AAU7D;AACA;AACA,YAAY,SAAS;AACrB;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyJA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqiBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA,sRAAsR;AACtR,0B;;;;;;;;;;;;;;;;;ACxvBA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA,2CAA2C,MAAM;AACjD,4CAA4C,OAAO;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"attractor.bundle.js","sourcesContent":["import template from './attractor.pug';\nimport $ from 'jquery';\nimport { saveCanvas } from '../../utils/save-utils';\n\nconsole.log('attractor module has loaded');\n\nconst title = 'Аттрактор Лоренца';\n\nconst data = {\n  'a': 5,\n  'b': 15,\n  'c': 1,\n  'dt': 0.0001,\n  'iterations': 500000\n};\n\nconst HSVtoRGB = (h) => {\n  const i = Math.floor(h * 6);\n  const f = Math.round((h * 6 - i) * 255);\n  const q = Math.round(255 - f);\n  switch (i % 6) {\n    case 0: return [255, f, 0]; break;\n    case 1: return [q, 255, 0]; break;\n    case 2: return [0, 255, f]; break;\n    case 3: return [0, q, 255]; break;\n    case 4: return [f, 0, 255]; break;\n    case 5: return [255, 0, q]; break;\n  }\n};\n\n\nconst drawAttractor = (context, w, h, {a, b, c, dt, iterations}) => {\n  let [x, y, z] = [3.051522, 1.582542, 15.62388];\n  context.clearRect(0, 0, w, h);\n  var imageData = context.getImageData(0, 0, w, h);\n  var idx = 0;\n  const iterationPercent = 1 / iterations;\n  var i = iterations;\n  while (i--) {\n    [x, y, z] = [\n      x + a * (-x + y) * dt,\n      y + (b * x - y - z * x) * dt,\n      z + (-c * z + x * y) * dt\n    ];\n    idx = 4 * (Math.round(19.3 * (y - x * 0.292893) + 320) + Math.round(-11 * (z + x * 0.292893) + 392) * w);\n    const hue = i * iterationPercent;\n    const [col_r, col_g, col_b] = HSVtoRGB(hue);\n    imageData.data[idx + 0] = col_r;  // r\n    imageData.data[idx + 1] = col_g;  // g\n    imageData.data[idx + 2] = col_b;  // b\n    imageData.data[idx + 3] = 255;  // a\n  }\n  context.putImageData(imageData, 0, 0);\n};\n\n\nconst init = () => {\n  console.log('attractor init');\n\n  const activity = $(template());\n\n  const canvas = activity.find('#attractor-canvas');\n  const context = canvas[0].getContext('2d');\n  const h = parseInt(canvas.attr(\"height\"));\n  const w = parseInt(canvas.attr(\"width\"));\n\n  activity\n    .find('input[data-param]')\n    .on('input', (e) => {\n      const input = e.target;\n      const { param } = input.dataset;\n      if (param === 'iterations') {\n        data[param] = parseFloat(input.value) * 1000;\n      } else {\n        data[param] = parseFloat(input.value);\n      }\n      console.log(data);\n      const t = Date.now();\n      drawAttractor(context, w, h, data);\n      console.log(Date.now() - t);\n    });\n\n  activity.find('#save-png-btn').click((e) => {\n    saveCanvas('attractor.png', canvas[0]);\n    e.preventDefault();\n  });\n\n  const deserializeForm = () => {\n    Object.entries(data).forEach(([key, value]) => {\n      if (key === 'iterations') {\n        value /= 1000;\n      }\n      const input = activity.find(`input[data-param=${key}]`);\n      input.val(value);\n      const step = parseFloat(input.attr('step'));\n      const numberOfZeroes = Math.max(Math.log10(1 / step), 0);\n      activity.find(`[data-bind=${key}]`).text(value.toFixed(numberOfZeroes));\n    });\n  };\n\n  deserializeForm();\n  drawAttractor(context, w, h, data);\n\n  return activity;\n};\n\nconst destroy = () => {\n  console.log('attractor destroyed');\n};\n\nexport default { title, init, destroy };\n","var pug = require(\"!../../../node_modules/pug-runtime/index.js\");\n\nfunction template(locals) {var pug_html = \"\", pug_mixins = {}, pug_interp;\n\n\n\n\n\n\n\n\n\npug_mixins[\"sliderInput\"] = pug_interp = function(variable, param_id, min, max, step, value){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nvar id = `${param_id}-input`\npug_html = pug_html + \"\\u003Cdiv class=\\\"input-group\\\"\\u003E\";\nif ((variable)) {\npug_html = pug_html + \"\\u003Cdiv class=\\\"input-group-prepend col-2 col-md-1 pr-0\\\"\\u003E\\u003Cspan class=\\\"input-group-text w-100\\\"\\u003E\" + (null == (pug_interp = variable) ? \"\" : pug_interp) + \"\\u003C\\u002Fspan\\u003E\\u003C\\u002Fdiv\\u003E\";\n}\npug_html = pug_html + \"\\u003Cdiv class=\\\"form-control col\\\"\\u003E\\u003Cinput\" + (\" class=\\\"form-control\\\"\"+\" type=\\\"range\\\"\"+pug.attr(\"id\", id, true, true)+pug.attr(\"name\", param_id, true, true)+pug.attr(\"min\", min, true, true)+pug.attr(\"max\", max, true, true)+pug.attr(\"step\", step, true, true)+pug.attr(\"value\", value, true, true)+pug.attr(\"data-param\", param_id, true, true)) + \"\\u003E\\u003C\\u002Fdiv\\u003E\\u003Cdiv class=\\\"input-group-append col-2 col-md-1 pl-0\\\"\\u003E\\u003Cspan\" + (\" class=\\\"input-group-text w-100\\\"\"+pug.attr(\"data-bind\", param_id, true, true)) + \"\\u003E\" + (pug.escape(null == (pug_interp = value) ? \"\" : pug_interp)) + \"\\u003C\\u002Fspan\\u003E\\u003C\\u002Fdiv\\u003E\\u003C\\u002Fdiv\\u003E\";\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\npug_mixins[\"octicon-desktop-download\"] = pug_interp = function(){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\npug_html = pug_html + \"\\u003Cspan class=\\\"octicon\\\"\\u003E\\u003Csvg xmlns=\\\"http:\\u002F\\u002Fwww.w3.org\\u002F2000\\u002Fsvg\\\" width=\\\"16\\\" height=\\\"16\\\" viewBox=\\\"0 0 16 16\\\"\\u003E\\u003Cpath fill-rule=\\\"evenodd\\\" d=\\\"M4 6h3V0h2v6h3l-4 4-4-4zm11-4h-4v1h4v8H1V3h4V2H1c-.55 0-1 .45-1 1v9c0 .55.45 1 1 1h5.34c-.25.61-.86 1.39-2.34 2h8c-1.48-.61-2.09-1.39-2.34-2H15c.55 0 1-.45 1-1V3c0-.55-.45-1-1-1z\\\"\\u002F\\u003E\\u003C\\u002Fsvg\\u003E\\u003C\\u002Fspan\\u003E\";\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\npug_mixins[\"form-row\"] = pug_interp = function(label){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\npug_html = pug_html + \"\\u003Cdiv class=\\\"form-group row\\\"\\u003E\\u003Clabel class=\\\"col-md-3\\\"\\u003E\" + (pug.escape(null == (pug_interp = label) ? \"\" : pug_interp)) + \"\\u003C\\u002Flabel\\u003E\\u003Cdiv class=\\\"col-md-9\\\"\\u003E\";\nblock && block();\npug_html = pug_html + \"\\u003C\\u002Fdiv\\u003E\\u003C\\u002Fdiv\\u003E\";\n};\npug_html = pug_html + \"\\u003Cdiv class=\\\"row\\\"\\u003E\\u003Cdiv class=\\\"col-12 col-lg-6\\\"\\u003E\\u003Ccanvas class=\\\"img-thumbnail\\\" id=\\\"attractor-canvas\\\" width=\\\"500\\\" height=\\\"500\\\"\\u003EВаш браузер не поддерживает canvas.\\u003C\\u002Fcanvas\\u003E\\u003C\\u002Fdiv\\u003E\\u003Cdiv class=\\\"col-12 col-lg-6\\\"\\u003E\\u003Cform id=\\\"attractor-form\\\"\\u003E\";\npug_mixins[\"form-row\"].call({\nblock: function(){\npug_mixins[\"sliderInput\"](\"σ\", \"a\", 0.1, 40.0, 0.01, 5.0);\n}\n}, \"Параметр σ\");\npug_mixins[\"form-row\"].call({\nblock: function(){\npug_mixins[\"sliderInput\"](\"r\", \"b\", 0.1, 40.0, 0.01, 15.0);\n}\n}, \"Параметр r\");\npug_mixins[\"form-row\"].call({\nblock: function(){\npug_mixins[\"sliderInput\"](\"b\", \"c\", 0.1, 40.0, 0.01, 1.0);\n}\n}, \"Параметр b\");\npug_mixins[\"form-row\"].call({\nblock: function(){\npug_mixins[\"sliderInput\"](\"dt\", \"dt\", 0.0001, 0.01, 0.0001, 0.0001);\n}\n}, \"Время между итерациями\");\npug_mixins[\"form-row\"].call({\nblock: function(){\npug_mixins[\"sliderInput\"](\"n\", \"iterations\", 10, 500, 10, 500);\n}\n}, \"Число итераций (x1000)\");\npug_html = pug_html + \"\\u003C\\u002Fform\\u003E\\u003Cdiv class=\\\"dropdown m-1\\\"\\u003E\\u003Cbutton class=\\\"btn btn-secondary dropdown-toggle\\\" data-toggle=\\\"dropdown\\\"\\u003E\";\npug_mixins[\"octicon-desktop-download\"]();\npug_html = pug_html + \"\\nСохранить как\\u003C\\u002Fbutton\\u003E\\u003Cdiv class=\\\"dropdown-menu\\\"\\u003E\\u003Ca class=\\\"dropdown-item\\\" id=\\\"save-png-btn\\\" href=\\\"#\\\"\\u003EPNG\\u003C\\u002Fa\\u003E\\u003C\\u002Fdiv\\u003E\\u003C\\u002Fdiv\\u003E\\u003C\\u002Fdiv\\u003E\\u003C\\u002Fdiv\\u003E\";;return pug_html;};\nmodule.exports = template;","export const saveBlob = (filename, blob) => {\n  saveImage(filename, URL.createObjectURL(blob));\n};\n\nexport const saveCanvas = (filename, canvas) => {\n  saveImage(filename, canvas.toDataURL());\n};\n\nexport const saveImage = (filename, dataUrl) => {\n  const anchor = document.createElement('a');\n  anchor.setAttribute('href', dataUrl);\n  anchor.setAttribute('target', '_blank');\n  anchor.setAttribute('download', filename);\n  if (document.createEvent) {\n    const evtObj = document.createEvent('MouseEvents');\n    evtObj.initEvent('click', true, true);\n    anchor.dispatchEvent(evtObj);\n  } else if (anchor.click) {\n    anchor.click();\n  }\n};\n\nexport const saveChart = (chart, filename, width = 800, height = 800) => {\n  const oldStyle = chart.canvas.parentNode.style;\n  const oldClass = chart.canvas.parentNode.className;\n  chart.canvas.parentNode.style.width = `${width}px`;\n  chart.canvas.parentNode.style.height = `${height}px`;\n  chart.canvas.parentNode.className = '';\n  chart.resize();\n  chart.render();\n  const dataUrl = chart.toBase64Image('image/png');\n  saveImage(filename, dataUrl);\n  chart.canvas.parentNode.style = oldStyle;\n  chart.canvas.parentNode.className = oldClass;\n};\n"],"sourceRoot":""}